name: CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

  workflow_dispatch:
  
jobs:
  tests:
  
    name: Test on ${{matrix.container }}
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        container: [' qgis/qgis:latest', 'qgis/qgis:release-3_22', 'qgis/qgis:release-3_20', 'qgis/qgis:release-3_18', 'qgis@sha256:fea5450e5128c40fc8c51dc3e29e37e82cbd4e6e536d4e85c973db523dfc477d']

    container: ${{ matrix.container }}
    
    steps:
    
    - name: Checkout Project
      uses: actions/checkout@v2.3.4
        
    - name: Unit Tests
      env:
        DISPLAY: :99
      run: |
        xvfb-run qgis_testrunner.sh tests.run_tests.run_all
